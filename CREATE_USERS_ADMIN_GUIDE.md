# Создание пользователей и администратора в Supabase

## Способ 1: Создание администратора через интерфейс Supabase (Рекомендуется)

### Шаг 1: Создание пользователя-администратора

1. **Откройте Supabase Dashboard:**
   - Перейдите на https://supabase.com/dashboard
   - Выберите ваш проект

2. **Перейдите в раздел Authentication:**
   - В левом меню нажмите **"Authentication"**
   - Выберите **"Users"**

3. **Добавьте нового пользователя:**
   - Нажмите кнопку **"Add user"** (зеленая кнопка справа)
   - Заполните форму:
     - **Email**: `admin@yourcompany.local`
     - **Password**: придумайте надежный пароль (например: `Admin123!`)
     - **Auto Confirm User**: ✅ **ОБЯЗАТЕЛЬНО ВКЛЮЧИТЕ**
   - Нажмите **"Create user"**

4. **Скопируйте ID пользователя:**
   - После создания пользователя вы увидите его в списке
   - Нажмите на строку с пользователем
   - Скопируйте **User UID** (например: `a1b2c3d4-e5f6-7890-abcd-ef1234567890`)

### Шаг 2: Создание профиля администратора

1. **Перейдите в SQL Editor:**
   - В левом меню нажмите **"SQL Editor"**
   - Нажмите **"New query"**

2. **Выполните SQL-запрос:**
   ```sql
   -- Замените 'ВСТАВЬТЕ_USER_ID_СЮДА' на реальный ID пользователя
   INSERT INTO manager_profiles (user_id, username, base_salary, sales_percentage, kpi_target, role)
   VALUES (
     'ВСТАВЬТЕ_USER_ID_СЮДА', 
     'admin', 
     0, 
     0, 
     0, 
     'admin'
   );
   ```

3. **Замените USER_ID и запустите:**
   - Замените `'ВСТАВЬТЕ_USER_ID_СЮДА'` на скопированный ID
   - Нажмите **"Run"** или Ctrl+Enter

## Способ 2: Создание через приложение (после входа администратора)

### После того как администратор создан и может войти в систему:

1. **Войдите как администратор:**
   - Перейдите на `/admin-login`
   - Логин: `admin`
   - Пароль: тот, что вы указали

2. **Перейдите в админ-панель:**
   - После входа нажмите **"Административная панель"**
   - Или перейдите на `/admin-panel`

3. **Добавьте нового менеджера:**
   - Нажмите **"Добавить менеджера"**
   - Заполните форму:
     - **Логин**: например `manager1`
     - **Пароль**: например `Manager123!`
     - **Базовая зарплата**: например `250000`
     - **Процент от продаж**: например `5`
     - **KPI цель**: например `500000`
   - Нажмите **"Создать"**

## Пример создания нескольких пользователей

### Создание через SQL (если нужно много пользователей сразу):

```sql
-- Сначала создайте пользователей в Authentication → Users через интерфейс:
-- 1. manager1@yourcompany.local / пароль: Manager123!
-- 2. manager2@yourcompany.local / пароль: Manager123!
-- 3. sales1@yourcompany.local / пароль: Sales123!

-- Затем выполните этот SQL (замените USER_ID на реальные):
INSERT INTO manager_profiles (user_id, username, base_salary, sales_percentage, kpi_target, role) VALUES
('USER_ID_MANAGER1', 'manager1', 250000, 5, 500000, 'manager'),
('USER_ID_MANAGER2', 'manager2', 300000, 7, 600000, 'manager'),
('USER_ID_SALES1', 'sales1', 200000, 10, 400000, 'manager');
```

## Структура логинов и паролей

### Как работает система аутентификации:

1. **Email формируется автоматически:**
   - Логин `admin` → Email `admin@yourcompany.local`
   - Логин `manager1` → Email `manager1@yourcompany.local`

2. **Пользователи входят только по логину:**
   - В форме входа вводят только логин (например: `admin`)
   - Система автоматически добавляет `@yourcompany.local`

## Роли пользователей

### Администратор (`role = 'admin'`):
- Может видеть админ-панель
- Может создавать/редактировать/удалять менеджеров
- Может видеть всех пользователей
- Не может быть удален другими администраторами

### Менеджер (`role = 'manager'`):
- Может видеть только свой профиль
- Может видеть свою зарплату и KPI
- Не может редактировать других пользователей
- Может быть отредактирован администратором

## Проверка созданных пользователей

### В Supabase Dashboard:

1. **Authentication → Users:**
   - Здесь видны все созданные пользователи
   - Можно проверить статус подтверждения

2. **Table Editor → manager_profiles:**
   - Здесь видны все профили менеджеров
   - Можно проверить роли и данные

### В приложении:

1. **Тест входа администратора:**
   - `/admin-login`
   - Логин: `admin`
   - Должен попасть в админ-панель

2. **Тест входа менеджера:**
   - `/admin-login`
   - Логин: `manager1` (или другой созданный)
   - Должен попасть в профиль менеджера

## Возможные проблемы и решения

### Проблема: "Invalid login credentials"
**Причины и решения:**
1. Пользователь не создан в Authentication → проверьте список пользователей
2. Неправильный пароль → проверьте пароль
3. Пользователь не подтвержден → включите "Auto Confirm User" при создании

### Проблема: "Профиль не найден"
**Причины и решения:**
1. Не создана запись в manager_profiles → выполните INSERT запрос
2. Неправильный user_id → проверьте соответствие ID в auth.users и manager_profiles

### Проблема: Пользователь не может войти в админ-панель
**Причины и решения:**
1. role не установлен как 'admin' → проверьте поле role в manager_profiles
2. Политики RLS блокируют доступ → проверьте выполнение SQL для создания политик

## Быстрый старт (минимальная настройка)

1. **Создайте одного администратора:**
   - Authentication → Users → Add user
   - Email: `admin@yourcompany.local`
   - Password: `Admin123!`
   - Auto Confirm: ✅

2. **Создайте профиль администратора:**
   ```sql
   INSERT INTO manager_profiles (user_id, username, role)
   VALUES ('СКОПИРОВАННЫЙ_USER_ID', 'admin', 'admin');
   ```

3. **Войдите в систему:**
   - `/admin-login`
   - Логин: `admin`
   - Пароль: `Admin123!`

4. **Создайте остальных пользователей через админ-панель**

Теперь у вас есть полностью функциональная система управления пользователями!